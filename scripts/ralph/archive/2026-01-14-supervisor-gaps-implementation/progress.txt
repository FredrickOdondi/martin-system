# Ralph Progress Log
Started: Wed Jan 14 03:03:00 AM EAT 2026

## Codebase Patterns
- Use `get_llm_service()` from `app.services.llm_service` for LLM client initialization
- Services take `AsyncSession` as constructor parameter for DB access
- Use `app.services.audit_service.audit_service` singleton for audit logging
- Document model uses `metadata_json` for flexible metadata storage
- Use `app.core.database.get_db_session_context()` for background task DB sessions
- WeeklyPacket model contains TWG progress data (accomplishments, risks, sessions)
- ActionItem model is used for task delegation to TWG agents (assign via owner_id)
- ProjectStatus enum defines lifecycle stages; use VALID_TRANSITIONS dict for state machine

---

## 2026-01-14 03:12 AM EAT - SDP-001
Thread: https://ampcode.com/threads/T-019bb9d0-4a51-750a-b467-bea0b8f6eb5b
- Implemented `DocumentPipelineService` class in `backend/app/services/document_pipeline_service.py`
- Added `trigger_declaration_synthesis(milestone)` to auto-compile Declaration using `DocumentSynthesizer`
- Implemented version control: `DocumentVersion` class with ZERO_DRAFT (0), FIRST_DRAFT (1), FINAL (2)
- Added `_gather_twg_sections()` to pull latest content from all TWG WeeklyPackets
- Integrated with `DocumentSynthesizer` for content generation
- Added `finalize_declaration()` and `get_declaration_history()` methods
- Exported service in `backend/app/services/__init__.py`
- Files changed:
  - `backend/app/services/document_pipeline_service.py` (new)
  - `backend/app/services/__init__.py` (modified)
- **Learnings for future iterations:**
  - Document model has `parent_document_id` for version chains
  - Use `metadata_json["title"].astext` for JSON field queries in SQLAlchemy
  - WeeklyPacket status "submitted" indicates ready for consumption
  - DocumentSynthesizer requires LLM client for synthesis operations
---

## 2026-01-14 03:18 AM EAT - PPC-001
Thread: https://ampcode.com/threads/T-019bb9da-37c4-700f-b385-a736ffe3cb99
- Implemented `ProjectPipelineService` class in `backend/app/services/project_pipeline_service.py`
- Extended `ProjectStatus` enum with new stages: DUE_DILIGENCE, FINANCING, DEAL_ROOM
- Added `advance_project_stage(project_id, new_stage)` with state machine validation
- Implemented `request_investment_vetting(project_id)` to create ActionItem for Resource Mobilization TWG
- Added `check_pipeline_health()` to identify stalled projects based on stage thresholds
- Added `get_project_stage_info()` for querying project stage and allowed transitions
- Transitioning to Due Diligence automatically triggers vetting task creation
- Exported service in `backend/app/services/__init__.py`
- Files changed:
  - `backend/app/services/project_pipeline_service.py` (new)
  - `backend/app/services/__init__.py` (modified)
  - `backend/app/models/models.py` (modified - extended ProjectStatus enum)
- **Learnings for future iterations:**
  - ActionItem is the model used for task delegation to TWG agents
  - Resource Mobilization TWG has pillar `TWGPillar.resource_mobilization`
  - Use `metadata_json` for flexible stage history tracking on Project model
  - TWG leads (technical_lead_id, political_lead_id) can be used as task owners
---
